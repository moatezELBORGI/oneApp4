# Configuration Coturn optimisée pour WebRTC - SOLUTION FINALE
# Cette configuration résout les problèmes de connexion lente

# === PORTS ===
listening-port=3478
tls-listening-port=5349

# === ADRESSES IP ===
listening-ip=0.0.0.0
relay-ip=51.91.99.191
external-ip=51.91.99.191

# === AUTHENTIFICATION ===
fingerprint
lt-cred-mech
use-auth-secret
static-auth-secret=SuperSecret1234567890abcdef1234567890abcdef
realm=51.91.99.191

# === SUPPORT STUN/TURN ===
# IMPORTANT: STUN ET TCP RELAY ACTIVÉS pour réseaux restrictifs

# === DURÉES DE VIE - OPTIMISÉES ===
# Augmentation des durées pour éviter les expirations prématurées
max-allocate-lifetime=7200
channel-lifetime=7200
permission-lifetime=7200
stale-nonce=600

# === RELAYS - OPTIMISATION RÉSEAU ===
mobility
no-multicast-peers

# === TLS/DTLS - SÉCURITÉ ===
no-cli
no-tlsv1
no-tlsv1_1
no-tlsv1_2

# === PERFORMANCE - OPTIMISATIONS CRITIQUES ===
# Augmentation du nombre de threads pour meilleure réactivité
relay-threads=16

# Plage de ports large pour éviter la saturation
min-port=49152
max-port=65535

# === OPTIMISATIONS WEBRTC ===
no-loopback-peers
no-multicast-peers

# NOUVEAU: Optimisations de timing pour connexion rapide
# Réduire le délai de réponse STUN/TURN
allocation-default-address-family=ipv4
no-stun-backward-compatibility

# NOUVEAU: Options pour réseaux restrictifs
# Permet aux clients derrière NAT strict de se connecter rapidement
bps-capacity=0
max-bps=0

# === LOGS - DÉTAILS ===
verbose
log-file=/var/log/turnserver/turnserver.log
simple-log

# === OPTIMISATIONS SUPPLÉMENTAIRES ===
# Désactiver les limitations de bande passante
no-tcp-relay-bandwidth-limit
no-udp-relay-bandwidth-limit

# Améliorer la réactivité des allocations
denied-peer-ip=0.0.0.0-0.255.255.255
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.168.0.0-192.168.255.255
